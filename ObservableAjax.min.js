(function(n,l){"object"===typeof exports&&"undefined"!==typeof module?module.exports=l():"function"===typeof define&&define.amd?define(l):n.ObservableAjax=l()})(this,function(){function n(a,b){if("this"===b||""===b)return a;b=b.split(".");for(var c=a;0!==b.length;){if(c instanceof Array){a=[];for(var d=0,f=c.length;d<f;d++)a.push(n(c[d],b.join(".")));return a}c=a[b.shift()];if(!c)break}return c}function l(a){return function(b){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];(f=b.notify).call.apply(f,
[b,a].concat(c));var f}}var g=function(){function a(){this.__value;this.observers=[]}a.prototype.addObserver=function(b){"function"===typeof b&&this.observers.push(b)};a.prototype.removeObserver=function(b){this.observers=this.observers.filter(function(a){return a!==b})};a.prototype.notify=function(b){for(var a=[],d=1;d<arguments.length;d++)a[d-1]=arguments[d];for(var d=0,f=this.observers.length;d<f;d++)this.observers[d].apply(b,a)};a.prototype.eachObserver=function(b){for(var a=0,d=this.observers.length;a<
d;a++)b(this.observers[a],a)};return a}(),q=function(a){return a},h=function(a){return"function"===typeof a},t=function(){},u=function(){return!0},m;(function(a){a[a.Net=519]="Net";a[a.Trans=520]="Trans"})(m||(m={}));var f;(function(a){a[a.updateStart=519]="updateStart";a[a.updateEnd=520]="updateEnd";a[a.updateFailed=521]="updateFailed"})(f||(f={}));return function(){function a(a){void 0===a&&(a=t);this.params={};this.paramSubject=new g;this.ajaxResponse={};this.paramVerifier=u;this.responseTransformer=
q;this.resSubject=new g;this.flowEvent=(b={},b[f.updateStart]=new g,b[f.updateEnd]=new g,b[f.updateFailed]=new g,b);this.ajaxFunc=a;var b}a.prototype.setParamVerifier=function(a){if(h(a))return this.paramVerifier=a,this};a.prototype.setResponseTransformer=function(a){if(h(a))return this.responseTransformer=a,this};a.prototype.addEventListener=function(a,c){if(!h(c)||!this.flowEvent[a])return this;this.flowEvent[a].addObserver(c);return this};a.prototype.removeEventListener=function(a,c){if(!h(c)||
!this.flowEvent[a])return this;this.flowEvent[a].removeObserver(c);return this};a.prototype.subscribe=function(a,c){if(!h(c))return this;c.__router=a;this.resSubject.addObserver(c);return this};a.prototype.unsubscribe=function(a){this.resSubject.removeObserver(a);return this};a.prototype.addParamCollector=function(a){if(!h(a))return this;this.paramSubject.addObserver(a);return this};a.prototype.removeParamCollector=function(a){this.paramSubject.removeObserver(a);return this};a.prototype.update=function(b){function c(a,
b){e.ajaxResponse=a;var c=e.responseTransformer(a,b);c&&e.resSubject.eachObserver(function(a,b){a(n(c,a.__router),e.params)});p(e.flowEvent[f.updateEnd],c,e.params)}function d(a){p(e.flowEvent[f.updateFailed],a);p(e.flowEvent[f.updateEnd])}function h(){var a=k.delay;0===a||a?setTimeout(function(){c(k.resData,e.params)},a):c(k.resData,e.params)}var e=this,k="object"===typeof b?b:{};b=k.params||{};var g=a.ajaxType,m=k.type||g.Net,p=l(e),q=k.extendArgs instanceof Array?k.extendArgs:[];e.paramSubject.notify(e,
e.params);for(var r in b)e.params[r]=b[r];if(!1!==e.paramVerifier(e.params))return p(e.flowEvent[f.updateStart],e.params),m===g.Net?e.ajaxFunc.apply(null,[e.params,c,d].concat(q)):h(),this};a.ajaxType=m;a.eventType=f;return a}()});